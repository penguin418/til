정규화

데이터 베이스 설계 문제를 해결하기 위해 테이블을 분해하는 방법

데이터베이스 설계 문제점

삽입 이상

어떤 관계 R에 레코드를 삽입 시 불필요한 정보(예를 들면, 중복된 데이터나 null) 도 추가해야 하는 경우 (아래의 BNF참조)

삭제이상

어떤 관계 R에 레코드 삭제 시, 원하지 않는 정보도 삭제해야 하는 경우(삽입 이상과 유사)

갱신이상

어떤 관계 R의 레코드 수정 시, 중복 저장된 데이터로 인해, 일부 속성이 갱신되지 않아 데이터 불일치가 발생하는 현상

분해방법

- 무손실 분해

    분해한 관계들을 다시 조인할 경우, 원래의 관계를 정보 손실 없이 복원 가능한 경우

- 종속성 보존

비정규형

raw데이터

제1정규형

어떤 관계(Relation) R의 모든 도메인의 값이 오직 원자값을 가진다

- 데이터베이스에선 모든 속성에 하나의 값만 들어가므로 모든 관계는 1정규형을 만족하게 됩니다. 하지만, NoSQL에서는 복합값을 가질 수 있으며 따라서 제1정규형을 만족하지 않는 경우도 있습니다
- 제 1정규화

    원자값이 아닌 도메인을 분해하여 모든 도메인이 원자값으로 구성되도록 합니다

    예를 들어

    ```jsx
    아이디    로그인정보
      1     user1, pass1
    ```

    ```jsx
    아이디  유저이름 비밀번호
      1     user1    pass1
    ```

    - 모든 도메인은 원자값만을 가져야 합니다
    - 모든 속성은 하나의 값만을 가져야 합니다

제2정규형

어떤 관계 R이 1NF이고, 키가 아닌 모든 속성이 기본키에 함수 종속적이다

- 제 2정규화

    어떤 관계 R이 제1 정규화에 속하고

    기본키에 완전 함수 종속되지 않는 속성을 모두 제거합니다
    (기본키에 속하지 않는 모든 속성이 기본키에 완전 함수 종속적이어야 합니다)

    예를 들어

    ```jsx
    학번  과목   성적  이름
    1     수학   99    민영
    2     통계   99    유정
    1     실험   90    민영
    ```

    ```jsx
    학생     	수강
    학번 이름	학번  과목  성적
    1    민영	1    수학   99
    2    유정	2    통계   99
             	1    실험   90
    ```

    함수 종속성이란

    속성의 의미와 값 사이의 제약조건입니다

    Y가 X에 함수 종속성을 갖음은 어떤 관계에서 속성들의 부분집합 X, Y 가 있을 때, 특정 튜플에서 X값이 Y값을 함수적으로 결정함을 의미합니다

    - Y가 X에 함수종속성을 갖을 때, X→Y로 표현합니다

        이때, Y를 종속자, X를 결정자라고 표현합니다

    - 위 예시에서 `학번`과 `이름`은 완전 종속 관계이지만, `학번`과 `과목`은 완전 종속 관계가 아니므로 분리합니다.

    완전 함수 종속

    어떤 기본키({A, B}) 가 존재할 떄 기본키의 모든 속성이 있어야 어떤 속성을 결정할 수 있음

    부분 함수 종속

    어떤 기본키({A, B}) 가 존재할 떄 기본키의 일부 속성만 있어도 어떤 속성을 결정할 수 있음

    이행 함수 종속

    X→Y이고  Y→Z임

제3정규형

어떤 관계 R이 2NF이고, 키가 아닌 모든 속성이 비 이행적 종속적이다

- 제 3정규화

    기본키에 속하지 않는 모든 속성을 기본키에 대한 이행적(transitive) 함수 종속이 아닌 상태로 바꿉니다.

    예를 들어

    ```jsx
    수강
    학번 과목 교수
    1    수학R12 은지
    2    수학R12 은지
    1    실험A33 유나
    ```

    ```jsx
    수강        	지도
    학번 과목    	과목    교수
    1    수학R12 	수학R12 은지
    2    수학R12 	수학R12 은지
    1    실험A33 	실험A33 유나
    ```

    - `학번`은 수강한 `과목`을 결정하지만, `교수`는 과목에 의해 결정됩니다(이행적 함수 종속입니다)

참고: [https://seollica.tistory.com/46](https://seollica.tistory.com/46)

BCNF(보이스코드정규형)

모든 결정자가 후보키인 관계

- 관계의 모든 결정자가 후보키인 경우 BCNF에 속합니다

    예를 들어(안좋은 예)

    ```jsx
    학생  과목 동호회
    민영  수학  낚시
          실험 축구
               아이스하키
    윤지  통계  그림
               네일아트
    ```

    ```jsx
    학생  과목  동호회
    민영  수학  낚시
               축구
               아이스하키
          실험 낚시
               축구
               아이스하키
    윤지   통계 그림
               네일아트
    ```

    모든 속성에 함수적 종속성이 존재하지 않아 모든 속성으로 구성되는 합성키를 사용합니다

    문제점

    테이블의 속성 간에는 관련이 없지만, 일관성을 유지하기 위해서는 가능한 모든 조합을 유지해야 합니다.

    예를 들어 `민영`이 새로운 과목을 수강할 경우 레코드를 3개 추가해야 합니다. 따라서 데이터의 심각한 중복이 발생합니다

    - 참고로 추가해야할 레코드는

        민영/통계/낚시

        민영/통계/축구

        민영/통계/아이스하키

    이런 상황을 다치종속 상황이라고 부릅니다

    학생 - - > > 과목 | 동호회

    - 다치 종속은 함수 종속성에 속하지 않습니다

참고 [https://itwiki.kr/w/다치_종속](https://itwiki.kr/w/%EB%8B%A4%EC%B9%98_%EC%A2%85%EC%86%8D)

제4정규형

어떤 관계 R에서 다치종속(MVD) A- - > > B가 성립하는 경우에 A가 주 키인 경우이다

- 제 4정규화

    BCNF를 만족하면서 다치(다중치) 종속을 제거하면 됩니다

    예를 들어

    ```jsx
    학생  과목  동호회
    민영  수학  낚시
               축구
               아이스하키
          실험 낚시
               축구
               아이스하키
    윤지   통계 그림
               네일아트
    ```

    에서 학생- - > > 과목 | 동호회 이므로

    ```jsx
    학생  과목    학생 동호회
    민영  수학    민영 낚시
          실험        축구
    윤지  통계        아이스하키
                 윤지 그림
                     네일아트
    ```

제5정규형

- 제 5정규화

    4정규형을 만족하면서 후보키를 통하지 않는 조인종속을 제거합니다.

    한 테이블을 분해했을 때, 분해한 결과를 다시 조인했을 때, 원래의 테이블로 동일하게 복원되는 제약조건